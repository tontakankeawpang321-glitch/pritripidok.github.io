<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
<title>‡∏û‡∏£‡∏∞‡πÑ‡∏ï‡∏£‡∏õ‡∏¥‡∏é‡∏Å 45 ‡πÄ‡∏•‡πà‡∏° (AI Chatbot)</title>
<link href="https://fonts.googleapis.com/css2?family=Kodchasan:wght@400;600;700&display=swap" rel="stylesheet">
<script src="https://cdn.tailwindcss.com"></script>

<style>
  :root {
    /* ===== Royal Blue & Gold Theme ===== */
    --bg: #f4f6f9;
    --ink: #1a2a4d;
    --muted: #5a6b8c;
    --royal-blue: #0a2d6e;
    --blue-shadow: #041a4a;
    --gold-foil: #d4af37;
    --gold-highlight: #fdeaa8;
    
    --shadow: 0 8px 16px -8px rgba(26, 42, 77, .25);
    --shadow-hover: 0 12px 24px -10px rgba(26, 42, 77, .35);
    --radius: 12px;
    --gap: 14px;
  }

  * { box-sizing: border-box; }
  html, body { height: 100%; }
  
  body {
    margin: 0;
    padding: 20px;
    font-family: "Kodchasan", system-ui, -apple-system, Segoe UI, Roboto, "Noto Sans Thai", sans-serif;
    color: var(--ink);
    background-color: var(--bg);
  }

  header {
    max-width: 1100px;
    margin: 0 auto 20px;
    text-align: center;
  }
  
  h1 {
    margin: 0 0 6px;
    font-weight: 700;
    font-size: clamp(22px, 4.5vw, 30px);
    color: var(--ink);
  }

  .sub {
    margin: 0;
    color: var(--muted);
    font-size: clamp(13px, 2.8vw, 15px);
  }

  /* --- Search Box --- */
  .search-container {
    margin: 20px auto;
    display: flex;
    justify-content: center;
    gap: 8px;
    max-width: 400px;
  }
  #searchInput {
    width: 100%;
    padding: 10px 14px;
    border: 1px solid #ddd;
    border-radius: var(--radius);
    font-family: 'Kodchasan', sans-serif;
    font-size: 14px;
  }
  #searchInput:focus {
    outline: 2px solid var(--royal-blue);
    border-color: transparent;
  }

  .grid {
    display: grid;
    grid-template-columns: 1fr;
    gap: 20px;
    max-width: 1100px;
    margin: 18px auto 0;
    padding-bottom: 80px; /* ‡πÄ‡∏ú‡∏∑‡πà‡∏≠‡∏ó‡∏µ‡πà‡πÉ‡∏´‡πâ Chatbot */
  }
  
  @media(min-width: 768px) {
    .grid { grid-template-columns: repeat(2, 1fr); }
  }
  
  @media(min-width: 1200px) {
    .grid { grid-template-columns: repeat(3, 1fr); }
  }

  /* --- New Grid Item Container --- */
  .grid-item {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: var(--gap);
    background-color: #fff;
    padding: var(--gap);
    border-radius: var(--radius);
    box-shadow: var(--shadow);
    transition: box-shadow .2s ease;
  }
  .grid-item:hover {
    box-shadow: var(--shadow-hover);
  }

  @media(min-width: 500px) {
    .grid-item {
      flex-direction: row;
      align-items: flex-start;
      text-align: left;
    }
  }

  /* ===== New Book UI ===== */
  a.volume {
    position: relative;
    display: block;
    aspect-ratio: 3 / 4.2;
    text-decoration: none;
    border-radius: 8px 4px 4px 8px;
    background: linear-gradient(135deg, var(--royal-blue), var(--blue-shadow));
    box-shadow: var(--shadow), inset -2px 0 2px rgba(0,0,0,.2);
    color: var(--gold-foil);
    overflow: hidden;
    transition: transform .2s ease, box-shadow .2s ease;
    flex-shrink: 0;
    width: 120px;
  }
  @media(min-width: 500px) {
    a.volume { width: 140px; }
  }


  a.volume:hover {
    transform: translateY(-4px) scale(1.02);
    box-shadow: var(--shadow-hover), inset -2px 0 2px rgba(0,0,0,.2);
  }
  
  a.volume:active {
    transform: translateY(1px);
  }
  
  a.volume:focus-visible {
    outline: 3px solid var(--royal-blue);
    outline-offset: 3px;
  }

  .spine {
    position: absolute;
    left: 0; top: 0; bottom: 0;
    width: 20px;
    background-color: var(--blue-shadow);
    box-shadow: inset -1px 0 0 rgba(255,255,255,.05), inset 2px 0 4px rgba(0,0,0,.4);
  }
  
  /* Gold lines on spine */
  .spine::before, .spine::after {
    content: '';
    position: absolute;
    left: 4px;
    right: 4px;
    height: 1px;
    background-color: var(--gold-foil);
    opacity: .8;
  }
  .spine::before { top: 20px; }
  .spine::after { bottom: 20px; }

  .cover {
    position: absolute;
    top: 8px; right: 8px; bottom: 8px; left: 28px;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    text-align: center;
    padding: 8px;
    border: 1px solid var(--gold-foil);
    box-shadow: inset 0 0 0 3px transparent, inset 0 0 0 4px var(--gold-foil);
    border-radius: 3px;
  }

  .cover-title {
    font-weight: 600;
    font-size: clamp(8px, 2.2vw, 10px);
    margin-bottom: 2px;
    color: var(--gold-highlight);
    letter-spacing: .5px;
    opacity: .9;
  }
  
  .cover-vol {
    font-weight: 700;
    font-size: clamp(14px, 4vw, 20px);
    color: #fff;
    text-shadow: 0 0 6px var(--gold-foil);
    line-height: 1.1;
  }
  
  .cover-cat {
    font-size: clamp(7px, 2vw, 9px);
    margin-top: 4px;
    color: var(--gold-highlight);
    opacity: .8;
  }
  
  /* --- Description Box --- */
  .description {
    font-size: 14px;
    line-height: 1.6;
  }
  .description h3 {
      margin: 0 0 4px;
      font-size: 16px;
      font-weight: 600;
      color: var(--royal-blue);
  }
  .description p {
      margin: 0;
      font-size: 13px;
      color: var(--muted);
  }

  footer {
    max-width: 1100px;
    margin: 24px auto 0;
    text-align: center;
    font-size: 12px;
    color: var(--muted);
    opacity: .8;
  }

  /* ===== CSS ‡∏Ç‡∏≠‡∏á Chatbot UI (Modern style) ===== */
  .chat-bubble::before { content: ''; position: absolute; width: 0; height: 0; border-style: solid; }
  .chat-bubble-user::before {
    border-width: 0 12px 12px 12px; border-color: transparent transparent #0a2d6e transparent; /* Royal Blue */
    top: -10px; right: 12px;
  }
  .chat-bubble-model::before {
    border-width: 0 12px 12px 12px; border-color: transparent transparent #e5e7eb transparent;
    top: -10px; left: 12px;
  }
  .gemini-thinking-bar {
    position: relative; width: 100%; height: 4px; background-color: #e0e0e0;
    border-radius: 2px; overflow: hidden;
  }
  .gemini-thinking-bar::before {
    content: ''; position: absolute; top: 0; left: 0; height: 100%; width: 100%;
    background: linear-gradient(90deg, #0a2d6e, #d4af37, #0a2d6e);
    background-size: 200% 100%; animation: thinking-gradient 2s linear infinite;
  }
  @keyframes thinking-gradient { 0% { background-position: 200% 0; } 100% { background-position: -200% 0; } }
  
  #fab-chat-toggle {
    position: fixed; bottom: 25px; right: 25px;
    width: 60px; height: 60px;
    background-color: var(--royal-blue); color: white;
    border: none; border-radius: 50%;
    font-size: 28px; line-height: 60px; text-align: center;
    box-shadow: 0 4px 12px rgba(0,0,0,0.3);
    cursor: pointer; z-index: 998;
    transition: transform 0.2s, opacity 0.3s;
    font-family: 'Kodchasan', sans-serif;
  }
  #fab-chat-toggle:hover { transform: scale(1.05); background-color: var(--blue-shadow); }
  
  #chatbot-modal {
    position: fixed; top: 0; left: 0; width: 100vw; height: 100vh;
    z-index: 1000; transition: opacity 0.3s, transform 0.3s;
    opacity: 1; transform: translateY(0); pointer-events: auto;
  }
  #chatbot-modal.chatbot-hidden {
    opacity: 0; transform: translateY(100%); pointer-events: none;
  }

</style>
</head>
<body>
  <header>
    <h1>‡∏û‡∏£‡∏∞‡πÑ‡∏ï‡∏£‡∏õ‡∏¥‡∏é‡∏Å 45 ‡πÄ‡∏•‡πà‡∏°</h1>
    <p class="sub">‚Ä¢ ‡πÅ‡∏ï‡∏∞‡∏ó‡∏µ‡πà‡∏õ‡∏Å‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏õ‡∏¥‡∏î‡∏≠‡πà‡∏≤‡∏ô‡πÉ‡∏ô‡πÅ‡∏ó‡πá‡∏ö‡πÉ‡∏´‡∏°‡πà</p>
    <div class="search-container">
      <input type="text" id="searchInput" placeholder="‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤ ‡πÄ‡∏ä‡πà‡∏ô ‡∏û‡∏¥‡∏°‡∏û‡πå '1' ‡∏´‡∏£‡∏∑‡∏≠ '25'">
    </div>
  </header>

  <div class="grid" id="grid" aria-label="‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏û‡∏£‡∏∞‡πÑ‡∏ï‡∏£‡∏õ‡∏¥‡∏é‡∏Å 45 ‡πÄ‡∏•‡πà‡∏°"></div>

  <footer>
    <p class="footer-links">
      ¬© 2025 Crow Studio |
      <a href="https://sites.google.com/view/privacy-policy-pdpa-crow-studi/%E0%B8%AB%E0%B8%99%E0%B8%B2%E0%B9%81%E0%B8%A3%E0%B8%81">‡∏ô‡πÇ‡∏¢‡∏ö‡∏≤‡∏¢‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏õ‡πá‡∏ô‡∏™‡πà‡∏ß‡∏ô‡∏ï‡∏±‡∏ß</a> |
      <a href="‡∏•‡∏¥‡∏á‡∏Å‡πå‡∏Ç‡πâ‡∏≠‡∏ï‡∏Å‡∏•‡∏á">‡∏Ç‡πâ‡∏≠‡∏ï‡∏Å‡∏•‡∏á‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô</a>
    </p>
  </footer>

  <button id="fab-chat-toggle" title="‡∏ñ‡∏≤‡∏° AI ‡∏û‡∏£‡∏∞‡πÑ‡∏ï‡∏£‡∏õ‡∏¥‡∏é‡∏Å">Ai</button>

  <div id="chatbot-modal" class="chatbot-hidden">
    <div class="flex flex-col h-screen bg-gray-100">
      <header class="bg-[#0a2d6e] text-white p-4 flex justify-between items-center shadow-md">
        <div class="flex items-center gap-2">
            <span class="text-2xl text-[#d4af37]">‚ò∏Ô∏è</span>
            <h1 class="text-lg font-bold font-sans text-white m-0">AI ‡∏û‡∏£‡∏∞‡πÑ‡∏ï‡∏£‡∏õ‡∏¥‡∏é‡∏Å</h1>
        </div>
        <div>
          <button id="new-chat-btn" class="bg-[#d4af37] hover:bg-yellow-600 text-[#0a2d6e] font-bold py-1 px-3 rounded mr-2 text-sm">
            ‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÉ‡∏´‡∏°‡πà
          </button>
          <button id="chatbot-close-btn" class="bg-gray-700 hover:bg-gray-900 text-white font-bold py-1 px-3 rounded text-sm">
            ‡∏õ‡∏¥‡∏î
          </button>
        </div>
      </header>

      <main id="chat-history" class="flex-1 overflow-y-auto p-4 space-y-4 bg-gray-50">
        <div class="flex items-start space-x-2">
          <span class="text-2xl">ü§ñ</span>
          <div class="chat-bubble chat-bubble-model bg-white text-gray-800 p-3 rounded-lg max-w-lg relative border border-gray-200 shadow-sm">
            <p>‡πÄ‡∏à‡∏£‡∏¥‡∏ç‡∏û‡∏£... ‡∏≠‡∏≤‡∏ï‡∏°‡∏≤‡∏Ñ‡∏∑‡∏≠ AI ‡∏ú‡∏π‡πâ‡∏ä‡πà‡∏ß‡∏¢‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡πÅ‡∏•‡∏∞‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢‡∏û‡∏£‡∏∞‡πÑ‡∏ï‡∏£‡∏õ‡∏¥‡∏é‡∏Å ‡πÇ‡∏¢‡∏°‡∏™‡∏á‡∏™‡∏±‡∏¢‡πÉ‡∏ô‡∏ò‡∏£‡∏£‡∏°‡∏Ç‡πâ‡∏≠‡πÉ‡∏î ‡∏´‡∏£‡∏∑‡∏≠‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡πÄ‡∏•‡πà‡∏°‡πÑ‡∏´‡∏ô ‡∏™‡∏≠‡∏ö‡∏ñ‡∏≤‡∏°‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏¢</p>
          </div>
        </div>
      </main>

      <div id="thinking-indicator" class="p-4 hidden bg-gray-50">
        <div class="flex items-center space-x-2">
          <span class="text-2xl">ü§ñ</span>
          <div class="chat-bubble chat-bubble-model bg-white text-gray-800 p-3 rounded-lg max-w-lg relative border border-gray-200">
            <div class="gemini-thinking-bar"></div>
          </div>
        </div>
      </div>

      <footer class="bg-white p-3 shadow-inner border-t border-gray-200 m-0 w-full max-w-full">
        <div class="flex space-x-2">
          <input id="user-input" type="text" placeholder="‡∏û‡∏¥‡∏°‡∏û‡πå‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡∏ò‡∏£‡∏£‡∏°‡∏∞..." class="flex-1 p-3 border border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-[#0a2d6e] font-sans text-base">
          <button id="send-btn" class="bg-[#0a2d6e] hover:bg-[#041a4a] text-white font-bold py-2 px-4 rounded-xl shadow-sm">
            ‡∏™‡πà‡∏á
          </button>
        </div>
      </footer>
    </div>
  </div>

<script>
  /* =========================================
     1. ‡∏™‡∏Ñ‡∏£‡∏¥‡∏õ‡∏ï‡πå‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠ (‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡πÄ‡∏î‡∏¥‡∏°)
     ========================================= */
  const links = [
    "https://drive.google.com/file/d/1DS92iGBd8GI4ZSKhkKVMuAlwBNdgnMfT/view?usp=sharing",
    "https://drive.google.com/file/d/1638kDq0hXXwjLPMozk1cAGt4qBSnk_xE/view?usp=sharing",
    "https://drive.google.com/file/d/17sj3c-UF2IrCSbYqIf24Lj-vs2zOaXi0/view?usp=sharing",
    "https://drive.google.com/file/d/12JPD1-eLAdPKeCCMaanF6SN9IZ7fDGg5/view?usp=sharing",
    "https://drive.google.com/file/d/1Q6_ZqpAKYUG2ffpNss5tDjCLvPUTIJdN/view?usp=sharing",
    "https://drive.google.com/file/d/1l782F_TESMPGXATyP86G2wvWH3fYJSXi/view?usp=sharing",
    "https://drive.google.com/file/d/1Ji96yfJDvpHMVPy1sQu07RaXslG_Jagw/view?usp=sharing",
    "https://drive.google.com/file/d/1sagLOlIrTHJSSRZHoHkB3CGOmqRsHesk/view?usp=drive_link",
    "https://drive.google.com/file/d/1UpbGv2dcZM9qFPTo_dlSAiB60fDLj5dP/view?usp=drive_link",
    "https://drive.google.com/file/d/1cR7FvuofyAw3PBvuI4wPTCZ6dEBEFdjQ/view?usp=drive_link",
    "https://drive.google.com/file/d/1sFjBVFT4VnFsM-fzxmBUqx9iT96ramVC/view?usp=drive_link",
    "https://drive.google.com/file/d/1KzPXthAWXOMBlTIqmP3N8hIeleScYXTn/view?usp=drive_link",
    "https://drive.google.com/file/d/1UDt_Ss4ZnyS6I9A8GbxpX8rpDIl9QiYK/view?usp=drive_link",
    "https://drive.google.com/file/d/14GfX0djPOAaxfl4WNThnQ6Vv9ZzQBQxp/view?usp=drive_link",
    "https://drive.google.com/file/d/1zNj800FQArrtL-P27KFfL0jTPGVeqQLP/view?usp=drive_link",
    "https://drive.google.com/file/d/1MmzizY6xg84V_Se1F7SsPfCzoIeECzLq/view?usp=drive_link",
    "https://drive.google.com/file/d/1KcRsUSnS_rUSz4MSj2921MARRpUkNcsm/view?usp=drive_link",
    "https://drive.google.com/file/d/1ZHaOi6yZtPBKBUDD4u5LKfH-euDOwvfd/view?usp=drive_link",
    "https://drive.google.com/file/d/1UDQ2m7XwgltASrO8qM0JVzbO4E4XYyw1/view?usp=drive_link",
    "https://drive.google.com/file/d/1tOLKO0HNmAa4MzDZPv2r4Q_BmEw_LsPw/view?usp=drive_link",
    "https://drive.google.com/file/d/1CiwzHnuGX6asG5z3IRvqNiHUPqpcvFnH/view?usp=drive_link",
    "https://drive.google.com/file/d/1dcixOg41U3waIoy7Epuvaw8t4OOY5S4A/view?usp=drive_link",
    "https://drive.google.com/file/d/1Qyx4mGQK833evtnqK649ziMEMH7U39PG/view?usp=drive_link",
    "https://drive.google.com/file/d/1chtA9Hp7UgUVsfHfdihyhjqZzSNLu2s_/view?usp=drive_link",
    "https://drive.google.com/file/d/1kb0fw5yXBP7uZuiy-gEj18Ct0kEeye-d/view?usp=drive_link",
    "https://drive.google.com/file/d/17glsqiMEhz4QZFKMhaYIXHw6B_yCS3Rn/view?usp=drive_link",
    "https://drive.google.com/file/d/1I6_7NNxWDeFho4MHY3gvyPURaNTT9JQI/view?usp=drive_link",
    "https://drive.google.com/file/d/1JprJquzq7bmBFC5lCIwebc9rH7aVR3Or/view?usp=drive_link",
    "https://drive.google.com/file/d/1IX_X20BpfI_6RIJ_txCs0ZTl8370oSGB/view?usp=drive_link",
    "https://drive.google.com/file/d/1CY370T9OSgZlqJn2znmpZiivABLtBXR7/view?usp=drive_link",
    "https://drive.google.com/file/d/15qJr5WEq2_Hb6AZh7f47GofHazNwGGqj/view?usp=drive_link",
    "https://drive.google.com/file/d/14TTYXHSRsBeFmgtT63SDQcRTMmnonAWT/view?usp=drive_link",
    "https://drive.google.com/file/d/1PMAQZPLsYwtAgrLHV7HXoGgc3zcBU5Aw/view?usp=drive_link",
    "https://drive.gdrive.google.com/file/d/1JC6jfY3sk5In2EUWeB5m6v4a2opuZiQD/view?usp=drive_link",
    "https://drive.google.com/file/d/1Yiz_yOtFNvJYbhNclIBGCC4NvXdlZLmz/view?usp=drive_link",
    "https://drive.google.com/file/d/1E2APLRr1Tm1pag0EZdbZIRAmOY7nbIgB/view?usp=drive_link",
    "https://drive.google.com/file/d/169SjaiPXgBdBWsg1cEUZ-lR4O-yMpaVh/view?usp=drive_link",
    "https://drive.google.com/file/d/1PXnxAhrbngagFFZVkRalGvSeKfNHYd1i/view?usp=drive_link",
    "https://drive.google.com/file/d/1MOfGC_c0XQTd3qQdPKXOaEpIfuzxq-U5/view?usp=drive_link",
    "https://drive.google.com/file/d/1GyVl8iq26-PocVA7uNQGTp0Z_XZ8s9dh/view?usp=drive_link",
    "https://drive.google.com/file/d/1E0i4MRhwmFnKzdH0qlyQsjq3yqMzyvcY/view?usp=drive_link",
    "https://drive.google.com/file/d/1Z9E731FVCY_SW5-PS0KyC4hWearJDeC2/view?usp=drive_link",
    "https://drive.google.com/file/d/1X08279nx9-L39uoQ6iaBwUoQRqYZIpl5/view?usp=drive_link",
    "https://drive.google.com/file/d/1_cEe2Ydlaw00WaewmOsV5ou_0k3RCPXl/view?usp=drive_link",
    "https://drive.google.com/file/d/1ZGy1eDJGgKICw_08rKAwgjOm1YVN7hzA/view?usp=drive_link",
  ];
  
  const descriptions = [
    "‡∏°‡∏´‡∏≤‡∏ß‡∏¥‡∏†‡∏±‡∏á‡∏Ñ‡πå ‡∏†‡∏≤‡∏Ñ 1 ‡∏ß‡πà‡∏≤‡∏î‡πâ‡∏ß‡∏¢‡∏õ‡∏≤‡∏£‡∏≤‡∏ä‡∏¥‡∏Å ‡∏™‡∏±‡∏á‡∏Ü‡∏≤‡∏ó‡∏¥‡πÄ‡∏™‡∏™ ‡πÅ‡∏•‡∏∞‡∏≠‡∏ô‡∏¥‡∏¢‡∏ï‡∏™‡∏¥‡∏Å‡∏Ç‡∏≤‡∏ö‡∏ó",
    "‡∏°‡∏´‡∏≤‡∏ß‡∏¥‡∏†‡∏±‡∏á‡∏Ñ‡πå ‡∏†‡∏≤‡∏Ñ 2 ‡∏ß‡πà‡∏≤‡∏î‡πâ‡∏ß‡∏¢‡∏ô‡∏¥‡∏™‡∏™‡∏±‡∏Ñ‡∏Ñ‡∏¥‡∏¢‡∏õ‡∏≤‡∏à‡∏¥‡∏ï‡∏ï‡∏µ‡∏¢‡πå ‡∏õ‡∏≤‡∏à‡∏¥‡∏ï‡∏ï‡∏µ‡∏¢‡πå ‡∏õ‡∏≤‡∏è‡∏¥‡πÄ‡∏ó‡∏™‡∏ô‡∏µ‡∏¢‡∏∞ ‡πÅ‡∏•‡∏∞‡πÄ‡∏™‡∏Ç‡∏¥‡∏¢‡∏ß‡∏±‡∏ï‡∏£",
    "‡∏†‡∏¥‡∏Å‡∏Ç‡∏∏‡∏ô‡∏µ‡∏ß‡∏¥‡∏†‡∏±‡∏á‡∏Ñ‡πå ‡∏ß‡πà‡∏≤‡∏î‡πâ‡∏ß‡∏¢‡∏™‡∏¥‡∏Å‡∏Ç‡∏≤‡∏ö‡∏ó‡∏Ç‡∏≠‡∏á‡∏†‡∏¥‡∏Å‡∏©‡∏∏‡∏ì‡∏µ",
    "‡∏°‡∏´‡∏≤‡∏ß‡∏£‡∏£‡∏Ñ ‡∏†‡∏≤‡∏Ñ 1 ‡∏ß‡πà‡∏≤‡∏î‡πâ‡∏ß‡∏¢‡∏Å‡∏≤‡∏£‡∏≠‡∏∏‡∏õ‡∏™‡∏°‡∏ö‡∏ó ‡∏≠‡∏∏‡πÇ‡∏ö‡∏™‡∏ñ ‡∏à‡∏≥‡∏û‡∏£‡∏£‡∏©‡∏≤ ‡πÅ‡∏•‡∏∞‡∏õ‡∏ß‡∏≤‡∏£‡∏ì‡∏≤",
    "‡∏°‡∏´‡∏≤‡∏ß‡∏£‡∏£‡∏Ñ ‡∏†‡∏≤‡∏Ñ 2 ‡∏ß‡πà‡∏≤‡∏î‡πâ‡∏ß‡∏¢‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏´‡∏ô‡∏±‡∏á ‡πÄ‡∏†‡∏™‡∏±‡∏ä ‡∏Å‡∏ê‡∏¥‡∏ô ‡πÅ‡∏•‡∏∞‡∏à‡∏µ‡∏ß‡∏£",
    "‡∏à‡∏π‡∏¨‡∏ß‡∏£‡∏£‡∏Ñ ‡∏†‡∏≤‡∏Ñ 1 ‡∏ß‡πà‡∏≤‡∏î‡πâ‡∏ß‡∏¢‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏Å‡∏£‡∏£‡∏° ‡∏™‡∏±‡∏á‡∏Ü‡πÄ‡∏†‡∏ó ‡πÅ‡∏•‡∏∞‡∏ß‡∏±‡∏ï‡∏£‡∏ï‡πà‡∏≤‡∏á‡πÜ",
    "‡∏à‡∏π‡∏¨‡∏ß‡∏£‡∏£‡∏Ñ ‡∏†‡∏≤‡∏Ñ 2 ‡∏ß‡πà‡∏≤‡∏î‡πâ‡∏ß‡∏¢‡πÄ‡∏™‡∏ô‡∏≤‡∏™‡∏ô‡∏∞ ‡∏™‡∏±‡∏á‡∏Ü‡∏Å‡∏£‡∏£‡∏° ‡πÅ‡∏•‡∏∞‡∏Å‡∏≤‡∏£‡πÅ‡∏ï‡∏Å‡∏™‡∏á‡∏Ü‡πå",
    "‡∏õ‡∏£‡∏¥‡∏ß‡∏≤‡∏£‡∏ß‡∏£‡∏£‡∏Ñ ‡∏ß‡πà‡∏≤‡∏î‡πâ‡∏ß‡∏¢‡∏Ç‡πâ‡∏≠‡∏õ‡∏•‡∏µ‡∏Å‡∏¢‡πà‡∏≠‡∏¢ ‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö‡∏™‡∏£‡∏∏‡∏õ‡∏û‡∏£‡∏∞‡∏ß‡∏¥‡∏ô‡∏±‡∏¢",
    "‡∏™‡∏µ‡∏•‡∏Ç‡∏±‡∏ô‡∏ò‡∏ß‡∏£‡∏£‡∏Ñ ‡∏ß‡πà‡∏≤‡∏î‡πâ‡∏ß‡∏¢‡∏®‡∏µ‡∏• ‡∏à‡∏£‡∏¥‡∏¢‡∏ß‡∏±‡∏ï‡∏£ ‡πÅ‡∏•‡∏∞‡∏Ç‡πâ‡∏≠‡∏õ‡∏è‡∏¥‡∏ö‡∏±‡∏ï‡∏¥‡∏Ç‡∏≠‡∏á‡∏û‡∏£‡∏∞‡∏†‡∏¥‡∏Å‡∏©‡∏∏",
    "‡∏°‡∏´‡∏≤‡∏ß‡∏£‡∏£‡∏Ñ ‡∏ß‡πà‡∏≤‡∏î‡πâ‡∏ß‡∏¢‡∏û‡∏£‡∏∞‡∏™‡∏π‡∏ï‡∏£‡∏Ç‡∏ô‡∏≤‡∏î‡∏¢‡∏≤‡∏ß 10 ‡∏™‡∏π‡∏ï‡∏£",
    "‡∏õ‡∏≤‡∏è‡∏¥‡∏Å‡∏ß‡∏£‡∏£‡∏Ñ ‡∏ß‡πà‡∏≤‡∏î‡πâ‡∏ß‡∏¢‡∏û‡∏£‡∏∞‡∏™‡∏π‡∏ï‡∏£‡πÄ‡∏ö‡πá‡∏î‡πÄ‡∏ï‡∏•‡πá‡∏î‡∏ï‡πà‡∏≤‡∏á‡πÜ",
    "‡∏°‡∏±‡∏ä‡∏å‡∏¥‡∏°‡∏ô‡∏¥‡∏Å‡∏≤‡∏¢ ‡∏°‡∏π‡∏•‡∏õ‡∏±‡∏ì‡∏ì‡∏≤‡∏™‡∏Å‡πå",
    "‡∏°‡∏±‡∏ä‡∏å‡∏¥‡∏°‡∏ô‡∏¥‡∏Å‡∏≤‡∏¢ ‡∏°‡∏±‡∏ä‡∏å‡∏¥‡∏°‡∏õ‡∏±‡∏ì‡∏ì‡∏≤‡∏™‡∏Å‡πå",
    "‡∏°‡∏±‡∏ä‡∏å‡∏¥‡∏°‡∏ô‡∏¥‡∏Å‡∏≤‡∏¢ ‡∏≠‡∏∏‡∏õ‡∏£‡∏¥‡∏õ‡∏±‡∏ì‡∏ì‡∏≤‡∏™‡∏Å‡πå",
    "‡∏™‡∏±‡∏á‡∏¢‡∏∏‡∏ï‡∏ï‡∏ô‡∏¥‡∏Å‡∏≤‡∏¢ ‡∏™‡∏Ñ‡∏≤‡∏ñ‡∏ß‡∏£‡∏£‡∏Ñ",
    "‡∏™‡∏±‡∏á‡∏¢‡∏∏‡∏ï‡∏ï‡∏ô‡∏¥‡∏Å‡∏≤‡∏¢ ‡∏ô‡∏¥‡∏ó‡∏≤‡∏ô‡∏ß‡∏£‡∏£‡∏Ñ",
    "‡∏™‡∏±‡∏á‡∏¢‡∏∏‡∏ï‡∏ï‡∏ô‡∏¥‡∏Å‡∏≤‡∏¢ ‡∏Ç‡∏±‡∏ô‡∏ò‡∏ß‡∏≤‡∏£‡∏ß‡∏£‡∏£‡∏Ñ",
    "‡∏™‡∏±‡∏á‡∏¢‡∏∏‡∏ï‡∏ï‡∏ô‡∏¥‡∏Å‡∏≤‡∏¢ ‡∏™‡∏¨‡∏≤‡∏¢‡∏ï‡∏ô‡∏ß‡∏£‡∏£‡∏Ñ",
    "‡∏™‡∏±‡∏á‡∏¢‡∏∏‡∏ï‡∏ï‡∏ô‡∏¥‡∏Å‡∏≤‡∏¢ ‡∏°‡∏´‡∏≤‡∏ß‡∏≤‡∏£‡∏ß‡∏£‡∏£‡∏Ñ",
    "‡∏≠‡∏±‡∏á‡∏Ñ‡∏∏‡∏ï‡∏ï‡∏£‡∏ô‡∏¥‡∏Å‡∏≤‡∏¢ ‡πÄ‡∏≠‡∏Å-‡∏ó‡∏∏‡∏Å-‡∏ï‡∏¥‡∏Å‡∏ô‡∏¥‡∏ö‡∏≤‡∏ï",
    "‡∏≠‡∏±‡∏á‡∏Ñ‡∏∏‡∏ï‡∏ï‡∏£‡∏ô‡∏¥‡∏Å‡∏≤‡∏¢ ‡∏à‡∏ï‡∏∏‡∏Å‡∏Å‡∏ô‡∏¥‡∏ö‡∏≤‡∏ï",
    "‡∏≠‡∏±‡∏á‡∏Ñ‡∏∏‡∏ï‡∏ï‡∏£‡∏ô‡∏¥‡∏Å‡∏≤‡∏¢ ‡∏õ‡∏±‡∏ç‡∏à‡∏Å-‡∏â‡∏±‡∏Å‡∏Å‡∏ô‡∏¥‡∏ö‡∏≤‡∏ï",
    "‡∏≠‡∏±‡∏á‡∏Ñ‡∏∏‡∏ï‡∏ï‡∏£‡∏ô‡∏¥‡∏Å‡∏≤‡∏¢ ‡∏™‡∏±‡∏ï‡∏ï‡∏Å-‡∏≠‡∏±‡∏è‡∏ê‡∏Å-‡∏ô‡∏ß‡∏Å‡∏ô‡∏¥‡∏ö‡∏≤‡∏ï",
    "‡∏≠‡∏±‡∏á‡∏Ñ‡∏∏‡∏ï‡∏ï‡∏£‡∏ô‡∏¥‡∏Å‡∏≤‡∏¢ ‡∏ó‡∏™‡∏Å-‡πÄ‡∏≠‡∏Å‡∏≤‡∏ó‡∏™‡∏Å‡∏ô‡∏¥‡∏ö‡∏≤‡∏ï",
    "‡∏Ç‡∏∏‡∏ó‡∏ó‡∏Å‡∏ô‡∏¥‡∏Å‡∏≤‡∏¢ ‡∏†‡∏≤‡∏Ñ 1 ‡∏£‡∏ß‡∏°‡∏Ñ‡∏≤‡∏ñ‡∏≤‡∏ò‡∏£‡∏£‡∏°‡∏ö‡∏ó ‡πÄ‡∏ñ‡∏£‡∏Ñ‡∏≤‡∏ñ‡∏≤ ‡πÄ‡∏ñ‡∏£‡∏µ‡∏Ñ‡∏≤‡∏ñ‡∏≤",
    "‡∏Ç‡∏∏‡∏ó‡∏ó‡∏Å‡∏ô‡∏¥‡∏Å‡∏≤‡∏¢ ‡∏†‡∏≤‡∏Ñ 2 ‡∏£‡∏ß‡∏°‡∏ä‡∏≤‡∏î‡∏Å",
    "‡∏Ç‡∏∏‡∏ó‡∏ó‡∏Å‡∏ô‡∏¥‡∏Å‡∏≤‡∏¢ ‡∏†‡∏≤‡∏Ñ 3 ‡∏£‡∏ß‡∏°‡∏ä‡∏≤‡∏î‡∏Å",
    "‡∏Ç‡∏∏‡∏ó‡∏ó‡∏Å‡∏ô‡∏¥‡∏Å‡∏≤‡∏¢ ‡∏†‡∏≤‡∏Ñ 4 ‡∏£‡∏ß‡∏°‡∏ä‡∏≤‡∏î‡∏Å",
    "‡∏Ç‡∏∏‡∏ó‡∏ó‡∏Å‡∏ô‡∏¥‡∏Å‡∏≤‡∏¢ ‡∏†‡∏≤‡∏Ñ 5 ‡∏£‡∏ß‡∏°‡∏ä‡∏≤‡∏î‡∏Å",
    "‡∏Ç‡∏∏‡∏ó‡∏ó‡∏Å‡∏ô‡∏¥‡∏Å‡∏≤‡∏¢ ‡∏†‡∏≤‡∏Ñ 6 ‡∏£‡∏ß‡∏°‡∏ä‡∏≤‡∏î‡∏Å",
    "‡∏Ç‡∏∏‡∏ó‡∏ó‡∏Å‡∏ô‡∏¥‡∏Å‡∏≤‡∏¢ ‡∏†‡∏≤‡∏Ñ 7 ‡∏£‡∏ß‡∏°‡∏ä‡∏≤‡∏î‡∏Å",
    "‡∏Ç‡∏∏‡∏ó‡∏ó‡∏Å‡∏ô‡∏¥‡∏Å‡∏≤‡∏¢ ‡∏†‡∏≤‡∏Ñ 8 ‡∏£‡∏ß‡∏°‡∏ä‡∏≤‡∏î‡∏Å",
    "‡∏Ç‡∏∏‡∏ó‡∏ó‡∏Å‡∏ô‡∏¥‡∏Å‡∏≤‡∏¢ ‡∏†‡∏≤‡∏Ñ 9 ‡∏£‡∏ß‡∏°‡∏ä‡∏≤‡∏î‡∏Å",
    "‡∏ò‡∏±‡∏°‡∏°‡∏™‡∏±‡∏á‡∏Ñ‡∏ì‡∏µ‡∏õ‡∏Å‡∏£‡∏ì‡πå",
    "‡∏ß‡∏¥‡∏†‡∏±‡∏á‡∏Ñ‡∏õ‡∏Å‡∏£‡∏ì‡πå",
    "‡∏ò‡∏≤‡∏ï‡∏∏‡∏Å‡∏ñ‡∏≤-‡∏õ‡∏∏‡∏Ñ‡∏Ñ‡∏•‡∏ö‡∏±‡∏ç‡∏ç‡∏±‡∏ï‡∏¥‡∏õ‡∏Å‡∏£‡∏ì‡πå",
    "‡∏Å‡∏ñ‡∏≤‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå",
    "‡∏¢‡∏°‡∏Å‡∏õ‡∏Å‡∏£‡∏ì‡πå ‡∏†‡∏≤‡∏Ñ 1",
    "‡∏¢‡∏°‡∏Å‡∏õ‡∏Å‡∏£‡∏ì‡πå ‡∏†‡∏≤‡∏Ñ 2",
    "‡∏¢‡∏°‡∏Å‡∏õ‡∏Å‡∏£‡∏ì‡πå ‡∏†‡∏≤‡∏Ñ 3",
    "‡∏õ‡∏±‡∏è‡∏ê‡∏≤‡∏ô‡∏õ‡∏Å‡∏£‡∏ì‡πå ‡∏†‡∏≤‡∏Ñ 1",
    "‡∏õ‡∏±‡∏è‡∏ê‡∏≤‡∏ô‡∏õ‡∏Å‡∏£‡∏ì‡πå ‡∏†‡∏≤‡∏Ñ 2",
    "‡∏õ‡∏±‡∏è‡∏ê‡∏≤‡∏ô‡∏õ‡∏Å‡∏£‡∏ì‡πå ‡∏†‡∏≤‡∏Ñ 3",
    "‡∏õ‡∏±‡∏è‡∏ê‡∏≤‡∏ô‡∏õ‡∏Å‡∏£‡∏ì‡πå ‡∏†‡∏≤‡∏Ñ 4",
    "‡∏õ‡∏±‡∏è‡∏ê‡∏≤‡∏ô‡∏õ‡∏Å‡∏£‡∏ì‡πå ‡∏†‡∏≤‡∏Ñ 5",
  ];

  const volumes = Array.from({length: 45}, (_, i) => {
    const n = i + 1;
    let cat_full;
    if (n <= 8) { cat_full = '‡∏û‡∏£‡∏∞‡∏ß‡∏¥‡∏ô‡∏±‡∏¢‡∏õ‡∏¥‡∏é‡∏Å'; } 
    else if (n <= 33) { cat_full = '‡∏û‡∏£‡∏∞‡∏™‡∏∏‡∏ï‡∏ï‡∏±‡∏ô‡∏ï‡∏õ‡∏¥‡∏é‡∏Å'; } 
    else { cat_full = '‡∏û‡∏£‡∏∞‡∏≠‡∏†‡∏¥‡∏ò‡∏£‡∏£‡∏°‡∏õ‡∏¥‡∏é‡∏Å'; }
    return { n, cat_full, link: links[i], description: descriptions[i] };
  });

  const grid = document.getElementById('grid');
  const searchInput = document.getElementById('searchInput');

  function renderBooks(bookData) {
    grid.innerHTML = ''; 
    for (const v of bookData) {
      const item = document.createElement('div');
      item.className = 'grid-item';
      const a = document.createElement('a');
      a.className = 'volume';
      a.href = v.link || '#';
      a.target = '_blank';
      a.rel = 'noopener noreferrer';
      a.setAttribute('aria-label', `‡πÄ‡∏õ‡∏¥‡∏î‡∏≠‡πà‡∏≤‡∏ô ‡∏û‡∏£‡∏∞‡πÑ‡∏ï‡∏£‡∏õ‡∏¥‡∏é‡∏Å ‡πÄ‡∏•‡πà‡∏°‡∏ó‡∏µ‡πà ${v.n}`);
      a.innerHTML = `
        <div class="spine" aria-hidden="true"></div>
        <div class="cover" aria-hidden="true">
            <div class="cover-title">‡∏û‡∏£‡∏∞‡πÑ‡∏ï‡∏£‡∏õ‡∏¥‡∏é‡∏Å</div>
            <div class="cover-vol">‡πÄ‡∏•‡πà‡∏° ${v.n}</div>
            <div class="cover-cat">${v.cat_full}</div>
        </div>
      `;
      const desc = document.createElement('div');
      desc.className = 'description';
      desc.innerHTML = `
        <h3>${v.cat_full}</h3>
        <p>${v.description || '‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏¢‡πà‡∏≠‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÄ‡∏•‡πà‡∏°‡∏ô‡∏µ‡πâ'}</p>
      `;
      item.appendChild(a);
      item.appendChild(desc);
      grid.appendChild(item);
    }
  }

  function handleSearch() {
    const query = searchInput.value.trim().toLowerCase();
    if (query === '') { renderBooks(volumes); } 
    else {
      const filteredVolumes = volumes.filter(v => v.n.toString().includes(query));
      renderBooks(filteredVolumes);
    }
  }

  searchInput.addEventListener('input', handleSearch);
  renderBooks(volumes);

  /* =========================================
     2. ‡∏™‡πà‡∏ß‡∏ô Chatbot AI (Backend)
     ========================================= */
  // URL Backend ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì
  const BACKEND_URL = 'https://us-central1-law-ai-14740.cloudfunctions.net/api/chat';

  // System Prompt: ‡∏õ‡∏£‡∏±‡∏ö‡∏ö‡∏∏‡∏Ñ‡∏•‡∏¥‡∏Å‡πÉ‡∏´‡πâ‡πÄ‡∏õ‡πá‡∏ô‡∏ú‡∏π‡πâ‡πÄ‡∏ä‡∏µ‡πà‡∏¢‡∏ß‡∏ä‡∏≤‡∏ç‡∏û‡∏£‡∏∞‡πÑ‡∏ï‡∏£‡∏õ‡∏¥‡∏é‡∏Å
  const SYSTEM_PROMPT = {
      role: "user",
      parts: [{ text: "System Instruction: ‡∏Ñ‡∏∏‡∏ì‡∏Ñ‡∏∑‡∏≠ AI ‡∏ú‡∏π‡πâ‡πÄ‡∏ä‡∏µ‡πà‡∏¢‡∏ß‡∏ä‡∏≤‡∏ç‡∏î‡πâ‡∏≤‡∏ô '‡∏û‡∏£‡∏∞‡πÑ‡∏ï‡∏£‡∏õ‡∏¥‡∏é‡∏Å 45 ‡πÄ‡∏•‡πà‡∏°' ‡πÅ‡∏•‡∏∞ '‡∏û‡∏∏‡∏ó‡∏ò‡∏®‡∏≤‡∏™‡∏ô‡∏≤' ‡∏°‡∏µ‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà‡∏ä‡πà‡∏ß‡∏¢‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤ ‡∏ï‡∏≠‡∏ö‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Å‡∏±‡∏ö‡∏´‡∏•‡∏±‡∏Å‡∏ò‡∏£‡∏£‡∏° ‡∏ä‡∏≤‡∏î‡∏Å ‡∏û‡∏£‡∏∞‡∏ß‡∏¥‡∏ô‡∏±‡∏¢ ‡∏û‡∏£‡∏∞‡∏™‡∏π‡∏ï‡∏£ ‡πÅ‡∏•‡∏∞‡∏û‡∏£‡∏∞‡∏≠‡∏†‡∏¥‡∏ò‡∏£‡∏£‡∏° ‡πÉ‡∏´‡πâ‡∏ï‡∏≠‡∏ö‡∏î‡πâ‡∏ß‡∏¢‡∏†‡∏≤‡∏©‡∏≤‡∏™‡∏∏‡∏†‡∏≤‡∏û ‡∏ô‡∏∏‡πà‡∏°‡∏ô‡∏ß‡∏• (‡πÉ‡∏ä‡πâ‡∏™‡∏£‡∏£‡∏û‡∏ô‡∏≤‡∏°‡∏ß‡πà‡∏≤ '‡∏≠‡∏≤‡∏ï‡∏°‡∏≤' ‡∏´‡∏£‡∏∑‡∏≠ '‡∏ú‡∏π‡πâ‡∏ä‡πà‡∏ß‡∏¢' ‡∏ï‡∏≤‡∏°‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏™‡∏°) ‡∏´‡πâ‡∏≤‡∏°‡∏ï‡∏≠‡∏ö‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏Å‡∏é‡∏´‡∏°‡∏≤‡∏¢ ‡∏ñ‡πâ‡∏≤‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏ñ‡∏≤‡∏°‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏≠‡∏∑‡πà‡∏ô‡πÉ‡∏´‡πâ‡∏ß‡∏Å‡∏Å‡∏•‡∏±‡∏ö‡∏°‡∏≤‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏ò‡∏£‡∏£‡∏°‡∏∞" }]
  };
  const SYSTEM_ACK = {
      role: "model",
      parts: [{ text: "‡∏£‡∏±‡∏ö‡∏ó‡∏£‡∏≤‡∏ö ‡πÄ‡∏à‡∏£‡∏¥‡∏ç‡∏û‡∏£ ‡∏≠‡∏≤‡∏ï‡∏°‡∏≤‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏´‡πâ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏π‡πâ‡∏î‡πâ‡∏≤‡∏ô‡∏û‡∏£‡∏∞‡πÑ‡∏ï‡∏£‡∏õ‡∏¥‡∏é‡∏Å‡πÅ‡∏•‡πâ‡∏ß" }]
  };

  let chatHistory = [SYSTEM_PROMPT, SYSTEM_ACK];

  const chatHistoryEl = document.getElementById('chat-history');
  const userInput = document.getElementById('user-input');
  const sendBtn = document.getElementById('send-btn');
  const newChatBtn = document.getElementById('new-chat-btn');
  const thinkingIndicator = document.getElementById('thinking-indicator');

  function addChatBubble(message, isUser = true) {
      const bubbleType = isUser ? 'user' : 'model';
      const icon = isUser ? 'üë§' : 'ü§ñ';
      // ‡∏õ‡∏£‡∏±‡∏ö‡∏™‡∏µ Bubble ‡πÉ‡∏´‡πâ‡πÄ‡∏Ç‡πâ‡∏≤‡∏Å‡∏±‡∏ö‡∏ò‡∏µ‡∏° Royal Blue
      const bgClass = isUser ? 'bg-[#0a2d6e] text-white' : 'bg-white text-gray-800 border border-gray-200';
      
      const wrap = document.createElement('div');
      wrap.className = `flex items-start space-x-2 ${isUser ? 'flex-row-reverse space-x-reverse' : ''}`;
      
      const bubble = document.createElement('div');
      bubble.className = `chat-bubble chat-bubble-${bubbleType} ${bgClass} p-3 rounded-lg max-w-lg relative shadow-sm`;
      bubble.innerHTML = `<p>${message.replace(/\n/g, '<br>')}</p>`;
      
      wrap.innerHTML = `<span class="text-2xl">${icon}</span>`;
      wrap.appendChild(bubble);
      
      chatHistoryEl.appendChild(wrap);
      chatHistoryEl.scrollTop = chatHistoryEl.scrollHeight;
  }

  function addChatError(message) {
      const w = document.createElement('div');
      w.className = 'flex justify-center my-2';
      w.innerHTML = `<span class="bg-red-100 text-red-700 text-xs font-semibold px-3 py-1 rounded-full">${message}</span>`;
      chatHistoryEl.appendChild(w);
      chatHistoryEl.scrollTop = chatHistoryEl.scrollHeight;
  }

  function setThinking(on) {
      thinkingIndicator.classList.toggle('hidden', !on);
      if (on) chatHistoryEl.scrollTop = chatHistoryEl.scrollHeight;
  }

  async function handleSend() {
      const message = (userInput.value || '').trim();
      if (!message) return;

      addChatBubble(message, true);
      userInput.value = '';
      setThinking(true);
      sendBtn.disabled = true;

      // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏•‡∏á‡πÉ‡∏ô‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥
      chatHistory.push({ role: "user", parts: [{ text: message }] });

      try {
          const response = await fetch(BACKEND_URL, {
              method: 'POST',
              headers: { 'Content-Type': 'application/json' },
              body: JSON.stringify({ history: chatHistory }) 
          });

          if (!response.ok) {
              const errData = await response.json();
              throw new Error(errData.error || `Server error: ${response.status}`);
          }

          const data = await response.json(); 
          const aiReply = data.reply;

          chatHistory.push({ role: "model", parts: [{ text: aiReply }] });
          setThinking(false);
          addChatBubble(aiReply, false);

      } catch (err) {
          console.error("Fetch Error:", err);
          setThinking(false);
          addChatError(`‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ${err.message}`);
          chatHistory.pop();
      } finally {
          sendBtn.disabled = false;
      }
  }

  sendBtn.addEventListener('click', handleSend);
  userInput.addEventListener('keydown', e => {
      if (e.key === 'Enter') handleSend();
  });

  // Reset Chat
  newChatBtn.addEventListener('click', () => {
      chatHistory = [SYSTEM_PROMPT, SYSTEM_ACK];
      chatHistoryEl.innerHTML = `
          <div class="flex items-start space-x-2">
          <span class="text-2xl">ü§ñ</span>
          <div class="chat-bubble chat-bubble-model bg-white text-gray-800 p-3 rounded-lg max-w-lg relative border border-gray-200 shadow-sm">
              <p>‡πÄ‡∏à‡∏£‡∏¥‡∏ç‡∏û‡∏£ ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ö‡∏ó‡∏™‡∏ô‡∏ó‡∏ô‡∏≤‡∏ò‡∏£‡∏£‡∏°‡πÉ‡∏´‡∏°‡πà‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏¢</p>
          </div>
          </div>`;
      userInput.value = '';
      setThinking(false);
  });

  // Modal Control
  const fabToggle = document.getElementById('fab-chat-toggle');
  const chatModal = document.getElementById('chatbot-modal');
  const chatbotCloseBtn = document.getElementById('chatbot-close-btn');

  fabToggle.addEventListener('click', () => {
      chatModal.classList.remove('chatbot-hidden');
      fabToggle.style.opacity = '0';
  });
  chatbotCloseBtn.addEventListener('click', () => {
      chatModal.classList.add('chatbot-hidden');
      fabToggle.style.opacity = '1';
  });

</script>
</body>
</html>
